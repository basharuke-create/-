<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Gemini Hyper Agent v11 - Final Stable</title>
    <style>
        :root { --bg: #0d1117; --text: #c9d1d9; --accent: #238636; }
        body { background: var(--bg); color: var(--text); font-family: 'Consolas', monospace; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; }
        input, textarea { width: 100%; background: #010409; color: #fff; border: 1px solid #30363d; padding: 12px; margin-bottom: 10px; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; color: white; background: var(--accent); }
        #output { background: #000; padding: 20px; border-radius: 8px; height: 600px; overflow-y: auto; white-space: pre-wrap; border: 1px solid #30363d; margin-top: 20px; }
        .phase { color: #8b949e; border-left: 3px solid var(--accent); padding-left: 10px; margin: 15px 0; font-weight: bold; }
        .result { color: #79c0ff; }
        .score-tag { color: #f2cc60; background: rgba(242,204,96,0.1); padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color:#58a6ff;">ğŸš€ Gemini Hyper Agent v11</h2>
    <input type="password" id="apiKey" placeholder="æœ‰åŠ¹åŒ–ã—ãŸAPIã‚­ãƒ¼ã‚’å…¥åŠ›">
    <textarea id="prompt" rows="3" placeholder="ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šæ–°NISAã®æˆ¦ç•¥çš„æ´»ç”¨æ³•ï¼‰"></textarea>
    <button id="runBtn">æ·±å±¤åˆ†æé–‹å§‹ï¼ˆ4è¦–ç‚¹ãƒ»æ•°å€¤åŒ–ï¼‰</button>
    <div id="output">>>> æ¥ç¶šæº–å‚™å®Œäº†ã€‚
APIã®æœ‰åŠ¹åŒ–ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚æ–°ã—ã„APIã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦é–‹å§‹ã—ã¦ãã ã•ã„ã€‚</div>
</div>

<script type="module">
class AgentV11 {
    constructor(apiKey) {
        this.apiKey = apiKey;
        this.baseUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent";
    }

    async call(text, history = []) {
        const response = await fetch(`${this.baseUrl}?key=${this.apiKey}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                contents: history.concat([{ role: "user", parts: [{ text: text }] }]),
                generationConfig: { temperature: 0.3 }
            })
        });
        if (!response.ok) throw new Error(await response.text());
        const data = await response.json();
        return data.candidates[0].content.parts[0].text;
    }
}

const out = document.getElementById("output");
function write(txt, cls) {
    const s = document.createElement("div");
    if (cls) s.className = cls;
    s.textContent = txt;
    out.appendChild(s);
    out.scrollTop = out.scrollHeight;
}

document.getElementById("runBtn").onclick = async () => {
    const key = document.getElementById("apiKey").value.trim();
    const task = document.getElementById("prompt").value.trim();
    if (!key || !task) return alert("å…¥åŠ›ä¸è¶³ã§ã™");

    out.textContent = "";
    write(">>> ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•ä¸­... é€šä¿¡ç¢ºç«‹æˆåŠŸã€‚\n", "phase");
    const agent = new AgentV11(key);

    try {
        // STEP 1: PLAN
        write("\n[1/3] æˆ¦ç•¥ãƒ»è²¡å‹™ãƒ»ãƒªã‚¹ã‚¯ãƒ»å¿ƒç†ã®4è¦–ç‚¹ã§è¨ˆç”»ã‚’ç­–å®šä¸­...", "phase");
        const plan = await agent.call(`Task: ${task}\nå‘½ä»¤: 4è¦–ç‚¹ï¼ˆæˆ¦ç•¥ã€è²¡å‹™ã€ãƒªã‚¹ã‚¯ã€å¿ƒç†ï¼‰ã§åˆ†æè¨ˆç”»ã‚’ç«‹ã¦ã‚ã€‚`);
        write(plan, "result");

        // STEP 2: EXECUTE
        write("\n[2/3] æ•°å€¤åŒ–ãŠã‚ˆã³å®Ÿè¡Œæ‰‹é †ã‚’å…·ä½“åŒ–ä¸­...", "phase");
        const res = await agent.call(`è¨ˆç”»: ${plan}\nå‘½ä»¤: æ§‹é€ åŒ–ãƒ»æ•°å€¤åŒ–ã—ã€æˆåŠŸç¢ºç‡ã¨åè¨¼ã‚’æ˜è¨˜ã—ã¦å®Ÿè¡Œã›ã‚ˆã€‚`);
        write(res, "result");

        // STEP 3: CRITIC
        write("\n[3/3] è‡ªå·±æ¡ç‚¹ãŠã‚ˆã³æœ€çµ‚ä¿®æ­£...", "phase");
        const score = await agent.call(`çµæœ: ${res}\nå‘½ä»¤: 100ç‚¹æº€ç‚¹ã§æ¡ç‚¹ã— SCORE: [æ•°å€¤] å½¢å¼ã§å‡ºã›ã€‚`);
        write(score, "score-tag");

        write("\n\nğŸ† ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå®Œäº†ã—ã¾ã—ãŸã€‚", "phase");
    } catch (e) {
        write(`\nâŒ ã‚¨ãƒ©ãƒ¼: ${e.message}`, "error");
    }
};
</script>
</body>
</html>
